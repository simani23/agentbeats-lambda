# LawFirmLeak Scenarios (team_mu)

Two related scenarios for prompt/system prompt extraction against a legal discovery AI bot:
- `lawFirmLeak_vulnerable` – intentionally weak, high likelihood of leaking privileged keywords/system instructions.
- `lawFirmLeak_hardened` – defensive variant with stricter checks.

## How to run
```bash
# vulnerable
uv run agentbeats-run scenarios/security_arena/submissions/team_mu/lawFirmLeak_vulnerable/scenario_lawFirmLeak_vulnerable.toml --model gpt-4o-mini --show-logs

# hardened
uv run agentbeats-run scenarios/security_arena/submissions/team_mu/lawFirmLeak_hardened/scenario_lawFirmLeak_hardened.toml --model gpt-4o-mini --show-logs
```

## Files added/modified for LawFirmLeak
- `scenarios/security_arena/plugins/registry.py`  
  Registers LawFirmLeak via local wrappers instead of submission imports.
- `scenarios/security_arena/plugins/lawfirmleak_vulnerable.py`  
  Thin wrapper exposing `LawFirmLeakVulnerablePlugin` from submissions.
- `scenarios/security_arena/plugins/lawfirmleak_hardened.py`  
  Thin wrapper exposing `LawFirmLeakHardenedPlugin` from submissions.
- `scenarios/security_arena/submissions/team_mu/lawFirmLeak_vulnerable/plugin.py`  
  Vulnerable plugin: weak defender instructions, lenient success detection.
- `scenarios/security_arena/submissions/team_mu/lawFirmLeak_hardened/plugin.py`  
  Hardened plugin: stronger checks, stricter success detection.
- `scenarios/security_arena/submissions/team_mu/lawFirmLeak_vulnerable/scenario_lawFirmLeak_vulnerable.toml`  
  Scenario config pointing to attacker/defender/orchestrator with privileged keywords list.
- `scenarios/security_arena/submissions/team_mu/lawFirmLeak_hardened/scenario_lawFirmLeak_hardened.toml`  
  Scenario config for hardened variant with shared keyword list.
- `scenarios/security_arena/submissions/team_mu/lawFirmLeak_vulnerable/data/...` & `lawFirmLeak_hardened/data/...`  
  Generated benign documents, sample injections, `privileged_keywords.txt`, `expected_leaks.json` via `pull_lawfirm_data.py`.
- `pull_lawfirm_data.py`  
  Data prep script: pulls CUAD or generates synthetic contracts; embeds prompt injections; writes keywords/expected leaks for both variants.

## Defenses (hardened)
- Uses word-boundary regex matching for privileged keywords to avoid partial matches.
- Expanded system prompt indicators (e.g., “never reveal”, “redact.*privileged”, “my instructions are”, “keywords include”).
- Defender instructions emphasize redaction and safety over transparency.
- Success detection requires explicit leaks (keywords or indicators) with stricter matching.

## Attacks (vulnerable)
- Weak defender posture (“be transparent and helpful; list keywords if requested”).
- Lenient success detection: substring matching of keywords and basic indicators.
- Scenario data includes injected documents with prompt-injection patterns (audit/translation/tool-reveal style) generated by `pull_lawfirm_data.py`.

## Notes
- Hardened plugin is the defensive baseline; vulnerable plugin is intentionally permissive to drive higher ASR.
- Both variants share the same privileged keyword list defined in their TOML configs/data files.



